import{r as e,j as t,R as n}from"./app-CzZmFL3t.js";import{S as r,P as o,W as a,B as i,a as s,A as l,b as c,C as d,c as u}from"./three.module-DofM9FX5.js";const h=({text:n,heartColor:r="transparent",flameColor:o="#ff3366",particlesMobile:a=4,particlesDesktop:i=8,strokeWidth:s=6})=>{const l=e.useRef(null);return e.useEffect(()=>{const e=l.current,t=e.getContext("2d");let o=window.innerWidth,c=window.innerHeight;e.width=o,e.height=c;const d=e=>{const t=Math.max(10,Math.min(Math.min(o,c)/40,25)),n=16*Math.pow(Math.sin(e),3),r=13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e);return{x:o/2+n*t,y:c/2-r*t-.1*c}};let u=[];const h=()=>{t.clearRect(0,0,o,c),t.beginPath();const e=[];for(let n=0;n<=2*Math.PI;n+=.02){const{x:r,y:o}=d(n);e.push({x:r,y:o}),0===n?t.moveTo(r,o):t.lineTo(r,o)}t.closePath(),t.strokeStyle=r,t.lineWidth=s,t.stroke();const l=c<768,f=l?a:i,m=l?35:40;for(let t=0;t<f;t++){const e=Math.random()*Math.PI*2,t=d(e),n=o/2-t.x,r=c/2-t.y,a=Math.sqrt(n*n+r*r),i=t.x+n/a*m,s=t.y+r/a*m,l=.01*(t.x-i),h=.01*(t.y-s);u.push({x:i,y:s,vx:l,vy:h,reachedEdge:!1,alpha:1,scale:.05+.12*Math.random()})}u.forEach(t=>{if(t.reachedEdge)t.alpha-=.01;else{t.x+=t.vx,t.y+=t.vy;for(const n of e){const e=t.x-n.x,r=t.y-n.y;if(e*e+r*r<64){t.reachedEdge=!0,t.vx=0,t.vy=0;break}}}}),u=u.filter(e=>e.alpha>0);for(const n of u)t.save(),t.translate(n.x,n.y),t.scale(n.scale,n.scale),t.beginPath(),t.moveTo(0,-30),t.bezierCurveTo(25,-60,60,-30,0,30),t.bezierCurveTo(-60,-30,-25,-60,0,-30),t.fillStyle=`rgba(255, 105, 180, ${n.alpha})`,t.fill(),t.restore();t.textAlign="center",t.textBaseline="middle";const g=.1*c,y=32*Math.max(10,Math.min(Math.min(o,c)/40,25))*.9;let p=.05*Math.min(o,c),w=[];function x(e,t,n,r){const o=t.split(" "),a=[];let i="";for(let s=0;s<o.length;s++){const t=i+(i?" ":"")+o[s];if(e.measureText(t).width>n&&i){if(a.push(i),i=o[s],a.length===r-1)break}else i=t}if(a.push(i),a.length===r&&o.length>0){let t=a[r-1];for(;e.measureText(t+"...").width>n&&t.length>0;)t=t.slice(0,-1);a[r-1]=t+"..."}return a}do{t.font=`bold ${p}px 'Mali', sans-serif`,w=x(t,n||"",y,3),p-=2}while((w.length>3||w.some(e=>t.measureText(e).width>y))&&p>10);t.font=`bold ${p}px 'Mali', sans-serif`;const v=1.2*p;w.forEach((e,n)=>{t.fillStyle="white",t.fillText(e,o/2,c/2-g+(n-(w.length-1)/2)*v)}),requestAnimationFrame(h)};h();const f=()=>{o=window.innerWidth,c=window.innerHeight,e.width=o,e.height=c};return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[n,r,o,a,i,s]),t.jsx("canvas",{ref:l,style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"transparent",zIndex:10}})},f=["3","2","1"],m={low:{dotGapMultiplier:1.5,effectIntensity:.7,blurEnabled:!1,maxFlyingDots:180},medium:{dotGapMultiplier:1.2,effectIntensity:.85,blurEnabled:!0,maxFlyingDots:387},high:{dotGapMultiplier:1,effectIntensity:1,blurEnabled:!0,maxFlyingDots:850}},g=e=>{if("undefined"==typeof window)return 0;const t=document.createElement("div");t.style.position="fixed",t.style[e]="env(safe-area-inset-"+e+")",t.style.visibility="hidden",document.body.appendChild(t);const n=getComputedStyle(t),r=parseInt(n[e])||0;return document.body.removeChild(t),r},y=({messages:h=[],onComplete:y=null,qualityOverride:p})=>{const w=e.useRef(null),x=e.useRef([]),v=e.useRef(null),M=e.useRef(0),b=e.useRef("countdown"),E=e.useRef(0),T=e.useRef(null),A=e.useRef(!1),I=e.useRef(0),S=e.useRef(0),C=e.useRef(!1),k=e.useRef(null),P=e.useRef(!1),R=e.useRef(0),F=n.useRef([]),z=e.useRef(0),[L,j]=n.useState(6),[D,$]=n.useState(4),[W,U]=n.useState("medium"),[H,G]=n.useState(!1);n.useEffect(()=>{if("undefined"!=typeof window&&!H){if("undefined"!=typeof localStorage&&!p){const e=localStorage.getItem("dotsQualityPreference");if(e&&("low"===e||"medium"===e||"high"===e))return U(e),void G(!0)}if(p)U(p);else{let e="medium";if("deviceMemory"in navigator||"hardwareConcurrency"in navigator){const t=navigator.deviceMemory||4,n=navigator.hardwareConcurrency||4;t<=2||n<=2?e="low":t>=8&&n>=6&&(e="high")}U(e)}G(!0)}},[p,H]),n.useEffect(()=>{const e=g("top"),t=g("bottom");if(g("left"),g("right"),"undefined"!=typeof window&&H){const n=!/Macintosh|MacIntel|MacPPC|Mac68K/.test(navigator.userAgent)&&window.innerHeight+e+t<=768;j(6);const r=n?3:4,o=m[p||W].dotGapMultiplier;$(r*o),E.current=performance.now()}},[W,H,p]);const q=e=>{const t=document.createElement("canvas");t.width=t.height=4*e;const n=t.getContext("2d"),r=4*e/2,o=n.createRadialGradient(r,r,0,r,r,r);return o.addColorStop(0,"rgba(255,255,255,1)"),o.addColorStop(.2,"rgba(200, 230, 255, 0.9)"),o.addColorStop(.5,"rgba(150, 200, 255, 0.6)"),o.addColorStop(1,"rgba(100, 150, 255, 0)"),n.fillStyle=o,n.beginPath(),n.arc(r,r,r,0,2*Math.PI),n.fill(),new d(t)},K=e=>{const t=g("top"),n=g("bottom"),r=g("left"),o=g("right"),a=document.createElement("canvas"),i=!/Macintosh|MacIntel|MacPPC|Mac68K/.test(navigator.userAgent)&&window.innerHeight+t+n<=768,s=i?window.innerWidth+r+o:800,l=i?window.innerHeight+t+n:350;a.width=s,a.height=l,a.style.width=`${s}px`,a.style.height=`${l}px`;const c=a.getContext("2d");c.fillStyle="#cce6ff",c.textAlign="center",c.textBaseline="middle";const d=.9*s;let u=150;if(c.font=`bold ${u}px system-ui, Arial, sans-serif`,document.fonts&&document.fonts.check&&!document.fonts.check(c.font))return setTimeout(()=>{B(e)},50),[];const m=e.split(" "),y=[];let p=m[0];for(let h=1;h<m.length;h++){const e=p+" "+m[h];c.measureText(e).width<d?p=e:(y.push(p),p=m[h])}for(y.push(p);y.length*(u+10)>l&&u>30;)u-=5,c.font=`bold ${u}px sans-serif`;c.clearRect(0,0,s,l);const w=u+10,x=l/2-(y.length-1)*w/2;y.forEach((e,t)=>{c.fillText(e,s/2,x+t*w)});const v=c.getImageData(0,0,s,l).data,M=[],b="3"===e||"2"===e||e===f[2]||e===h[0],E=e===f[2];for(let h=0;h<l;h+=Math.round(D))for(let t=0;t<s;t+=Math.round(D)){if(v[4*(h*s+t)+3]>128){const n=t-s/2,r=-(h-l/2),o=!E||Math.random()<.3,a=e===f[2]?0:o?1:0;M.push({x:b?0:400*Math.random()-200,y:b?0:400*Math.random()-200,tx:n,ty:r,vx:0,vy:0,vz:0,exploded:!1,opacity:a,glowIntensity:0})}}return M},B=e=>{const t=x.current.filter(e=>e.isExtra),n=K(e);x.current=n.concat(t),_()},_=()=>{const e=x.current,t=new Float32Array(3*e.length),n=new Float32Array(e.length),r=new Float32Array(e.length);e.forEach((e,o)=>{t[3*o]=e.x,t[3*o+1]=e.y,t[3*o+2]=0,n[o]=e.opacity,r[o]=e.glowIntensity});const o=v.current.geometry;o.setAttribute("position",new u(t,3)),o.setAttribute("alpha",new u(n,1)),o.setAttribute("glow",new u(r,1)),o.attributes.position.needsUpdate=!0,o.attributes.alpha.needsUpdate=!0,o.attributes.glow.needsUpdate=!0},N=(e=.4)=>{x.current.forEach(t=>{t.vx=(Math.random()-.5)*e,t.vy=(Math.random()-.5)*e,t.vz=(Math.random()-.5)*e,t.exploded=!0,t.opacity=.7*Math.random()+.3,t.glowIntensity=2.5}),P.current=!0,R.current=0},X=async(e,t)=>{var n,r;const o=K(e);if(e===f[2]){const e=K(h[0]),t=m[p||W].maxFlyingDots,a=Math.min(t,Math.floor(.12*e.length)),i=function(e,t,n=120){const r=800,o=300,a=document.createElement("canvas");a.width=r,a.height=o;const i=a.getContext("2d");i.fillStyle="#fff",i.textAlign="center",i.textBaseline="middle";const s=150;i.font=`900 ${s}px 'Roboto Mono', Arial Black, Arial, sans-serif`,i.clearRect(0,0,r,o),i.fillText(e,r/2,o/2),i.lineWidth=12,i.strokeStyle="#fff",i.strokeText(e,r/2,o/2);const l=i.getImageData(0,0,r,o),c=[],d=Math.max(2,Math.floor(150/n*4)),u=8,h=[];for(let m=-d;m<=d;m+=d)for(let e=-d;e<=d;e+=d)0===e&&0===m||h.push({dx:e,dy:m});const f=n<80?1:2;for(let m=d;m<o-d;m+=d*f){for(let e=d;e<r-d;e+=d*f){const t=4*(m*r+e);if(l.data[t+3]>u){let t=!1;for(let n=0;n<h.length&&!t;n++){const{dx:a,dy:i}=h[n],s=m+i,c=e+a;if(s<0||s>=o||c<0||c>=r)t=!0;else{const e=4*(s*r+c);l.data[e+3]<=u&&(t=!0)}}if(t&&(c.push({x:e,y:m}),c.length>=2*n))break}}if(c.length>=2*n)break}if(c.length>n){const e=Math.floor(c.length/n);return c.filter((t,n)=>n%e===0).slice(0,n).map(e=>({x:e.x-r/2,y:-(e.y-o/2)}))}return c.map(e=>({x:e.x-r/2,y:-(e.y-o/2)}))}(f[2],0,a);if(!i||0===i.length)return void console.warn("[transitionToText] outlinePoints is empty! Skipping flyDots for 1.");const s=[],l=5;for(let o=0;o<a;o++){const t=i[o%i.length],a=5,c=Math.random()*a*1-a,d=Math.random()*a*1-a,u=Math.floor(Math.random()*l),h={x:t.x+c,y:t.y+d,tx:(null==(n=e[o%e.length])?void 0:n.tx)??0,ty:(null==(r=e[o%e.length])?void 0:r.ty)??0,vx:0,vy:0,vz:0,exploded:!0,opacity:.15*Math.random()+.85,glowIntensity:0,isExtra:!0,delayStart:120*u,started:!1};let f;switch(u){case 0:f=1.2*Math.random()+1.8;break;case 1:f=1.8*Math.random()+1.2;break;case 2:f=1.5*Math.random()+1.8;break;case 3:f=1.5*Math.random()+1.5;break;default:f=1.8*Math.random()+1}const m=Math.random()*Math.PI*2;h.vx=Math.cos(m)*f*(.5+Math.random()),h.vy=Math.sin(m)*f*(.5+Math.random()),h.opacity=.7*Math.random()+.3,h.glowIntensity=2*Math.random()+.5,h.vx+=1.5*(Math.random()-.5),h.vy+=1.5*(Math.random()-.5),h.vz=.3*(Math.random()-.5),s.push(h)}const c=x.current,d=Array.from({length:o.length},(e,t)=>t);for(let n=d.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[d[n],d[e]]=[d[e],d[n]]}return o.forEach((e,t)=>{const n=d[t%d.length];c[n]&&(e.x=c[n].x,e.y=c[n].y)}),x.current=o,_(),S.current=performance.now(),C.current=!0,C.current=!1,setTimeout(()=>{F.current=s.map(e=>({...e,started:!0,vx:e.vx||1.5*(Math.random()-.5),vy:e.vy||1.5*(Math.random()-.5)}))},1600),void _()}if(!(t===f[2]&&h.length>0&&e===h[0])){const t=x.current,n=Array.from({length:o.length},(e,t)=>t);for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}if(o.forEach((e,r)=>{const o=n[r%n.length];t[o]&&(e.x=t[o].x,e.y=t[o].y)}),h.length>0&&e===h[h.length-2]){const e=Math.max(10,Math.floor(.08*o.length)),t=[];for(let n=0;n<e;n++){const e=Math.random()*Math.PI*2,n=350*Math.random()+100;t.push({x:Math.cos(e)*n,y:Math.sin(e)*n,tx:0,ty:0,vx:.7*(Math.random()-.5),vy:.7*(Math.random()-.5),vz:.3*(Math.random()-.5),exploded:!0,opacity:.7*Math.random()+.3,glowIntensity:1.5,isExtra:!0,isIndependence:!0})}F.current=t,x.current=o}else x.current=o;return void _()}{const e=p||W,t={low:.5,medium:.8,high:.8}[e],n=o.length,r=Math.floor(n*(t+.119)),a=Array.from({length:n},(e,t)=>t);for(let o=a.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[a[o],a[e]]=[a[e],a[o]]}const i=new Set(a.slice(0,r)),s=m[e].maxFlyingDots,l=a.slice(r,r+s),c=x.current,d=Array.from({length:r},(e,t)=>t);for(let o=d.length-1;o>0;o--){const e=Math.floor(Math.random()*(o+1));[d[o],d[e]]=[d[e],d[o]]}o.forEach((e,t)=>{if(i.has(t)){const n=d[t%d.length];c[n]&&(e.x=c[n].x,e.y=c[n].y)}}),x.current=o.filter((e,t)=>i.has(t)),_(),setTimeout(()=>{F.current=F.current.filter(e=>e.gathering||e.opacity>.4||e.isIndependence);const e=F.current;for(let t=0;t<Math.min(e.length,l.length);t++){const n=l[t];e[t].tx=o[n].tx,e[t].ty=o[n].ty,e[t].gathering=!0,e[t].opacity=Math.min(e[t].opacity+.3,1)}setTimeout(()=>{const e=[];x.current.forEach(t=>{t.isIndependence||e.push(t)});const t=new Set;x.current.forEach(e=>{e.isIndependence||t.add(`${e.tx},${e.ty}`)}),F.current.forEach(e=>{!e.isIndependence&&e.gathering&&e.opacity>.2&&t.add(`${e.tx},${e.ty}`)});const n=m[p||W],r=Math.min(n.maxFlyingDots,Math.floor(.3*o.length)),a=[];for(let i=0;i<o.length&&a.length<r;i++){const e=`${o[i].tx},${o[i].ty}`;t.has(e)||a.push(i)}x.current=e,_(),F.current.length>0&&setTimeout(()=>{const e=F.current.filter(e=>!e.isIndependence&&e.opacity>.2),t=Math.min(e.length,n.maxFlyingDots/2);for(let n=0;n<t;n++)if(!e[n].gathering&&Math.random()>.6&&(e[n].isExtra=!0,Math.random()>.5&&o.length>0)){const t=Math.floor(Math.random()*o.length);e[n].tx=o[t].tx,e[n].ty=o[t].ty,e[n].gathering=!0}"low"===W&&(F.current=F.current.filter(e=>e.gathering||e.opacity>.6||e.isIndependence))},1e3)},200)},1500)}};return e.useEffect(()=>{const e=new r;e.background=null;const t=new o(75,window.innerWidth/window.innerHeight,1,1e3);t.position.z=260;const n=new a({antialias:!0,alpha:!0,powerPreference:"high-performance"});n.setSize(window.innerWidth,window.innerHeight),n.setPixelRatio(window.devicePixelRatio);const d=w.current;null==d||d.appendChild(n.domElement);const g=new i;let j=q(L);const D=`\n            attribute float alpha;\n            attribute float glow;\n            varying float vAlpha;\n            varying float vGlow;\n            void main() {\n                vAlpha = alpha;\n                vGlow = glow;\n                vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n                gl_PointSize = ${L.toFixed(1)} * (300.0 / -mvPosition.z) * (1.0 + glow * 0.3);\n                gl_Position = projectionMatrix * mvPosition;\n            }\n        `,$="\n            varying float vAlpha;\n            varying float vGlow;\n            uniform sampler2D pointTexture;\n            uniform float uTime;\n            void main() {\n                vec4 texColor = texture2D(pointTexture, gl_PointCoord);\n                float pulse = 0.5 + 0.5 * sin(uTime * 5.0);\n                float glow = smoothstep(0.5, 1.0, vAlpha) * (1.0 + pulse * 0.5 + vGlow * 2.0);\n                vec3 baseColor = mix(\n                    vec3(0.7, 0.8, 1.0), \n                    vec3(0.4, 0.6, 1.5), \n                    smoothstep(1.0, 3.0, glow)\n                );\n                float alpha = vAlpha * texColor.a * (1.0 + glow * 2.0);\n                gl_FragColor = vec4(baseColor * (1.0 + glow * 0.8), alpha);\n            }\n        ";let U=new s({uniforms:{pointTexture:{value:j},uTime:{value:0}},vertexShader:D,fragmentShader:$,transparent:!0,depthWrite:!1,blending:l});const H=new c(g,U);e.add(H),v.current=H;const G=m[W].blurEnabled;let K=null,O=null;if(G){const t=new i;let n=q(2.5*L);O=new s({uniforms:{pointTexture:{value:n},uTime:{value:0}},vertexShader:D.replace(/gl_PointSize = ([^;]+);/,`gl_PointSize = (${(2.5*L).toFixed(1)}) * (300.0 / -mvPosition.z) * (1.0 + glow * 0.3);`),fragmentShader:$,transparent:!0,depthWrite:!1,blending:l}),K=new c(t,O),K.renderOrder=-1,e.add(K),k.current=K}const V=r=>{const o=performance.now(),a="low"===W?2:1;if(a>1&&o-(z.current||0)<16.67*a)return void requestAnimationFrame(V);const s=Math.min(1.5,(o-(z.current||o))/16.67);z.current=o,U.uniforms.uTime.value=.001*r;const l=x.current,d=v.current.geometry.attributes.position,h=v.current.geometry.attributes.alpha,g=v.current.geometry.attributes.glow;let y=0;if(A.current){const e=o-E.current;y=I.current*Math.max(0,1-e/800)}let w=0;if(C.current){const e=o-S.current;w=Math.max(0,1-e/1e3)}if(l.forEach((e,t)=>{if(e.isExtra)e.x+=e.vx*s,e.y+=e.vy*s,e.opacity*=Math.pow(.97,s),e.glowIntensity*=Math.pow(.96,s),e.opacity<.05&&(e.opacity=0);else if(e.exploded)e.x+=e.vx*s,e.y+=e.vy*s;else{const t=.05*s;e.x+=(e.tx-e.x)*t,e.y+=(e.ty-e.y)*t}f[M.current]===f[2]?e.glowIntensity=0:C.current?e.glowIntensity=2*w:e.glowIntensity*=Math.pow(.95,s),d.setXYZ(t,e.x,e.y,0);const n=e.exploded?e.opacity:1,o=y*(.5+.5*Math.sin(.005*r));h.setX(t,Math.min(2,n+o+.5*e.glowIntensity)),g.setX(t,e.glowIntensity)}),F.current.length>0){let t=e.getObjectByName("flyingDots");if(!t){const n=new i;t=new c(n,U),t.name="flyingDots",e.add(t)}const n=m[p||W].maxFlyingDots;F.current.length>n&&(F.current.sort((e,t)=>t.opacity-e.opacity),F.current=F.current.slice(0,n));const r=F.current,o=[],a=new Set;if(r.forEach((e,t)=>{if(e.gathering){const n=Math.sqrt(Math.pow(e.tx-e.x,2)+Math.pow(e.ty-e.y,2)),r=Math.max(.1,Math.min(.2,20/(n+20)))*s;e.x+=(e.tx-e.x)*r,e.y+=(e.ty-e.y)*r,Math.abs(e.x-e.tx)<2&&Math.abs(e.y-e.ty)<2&&(o.push({x:e.tx,y:e.ty,tx:e.tx,ty:e.ty,vx:0,vy:0,vz:0,exploded:!1,opacity:1,glowIntensity:-.6,isExtra:!1,gathering:!1}),a.add(t))}else{if(!1!==e.started){e.x+=e.vx*s,e.y+=e.vy*s;const t="low"===W?.01:.03;e.vx+=(Math.random()-.5)*t*s,e.vy+=(Math.random()-.5)*t*s;const n=2.5,r=Math.sqrt(e.vx*e.vx+e.vy*e.vy);r>n&&(e.vx=e.vx/r*n,e.vy=e.vy/r*n)}const n="low"===W?.95:.998;e.opacity*=Math.pow(n,s),e.opacity<.01&&a.add(t)}e.glowIntensity*=Math.pow(.9995,s),(Math.abs(e.x)>800||Math.abs(e.y)>600)&&a.add(t)}),o.length>0&&(x.current=[...x.current,...o],_()),F.current=r.filter((e,t)=>!a.has(t)),F.current.length>0){const e=new Float32Array(3*F.current.length),n=new Float32Array(F.current.length),r=new Float32Array(F.current.length);F.current.forEach((t,o)=>{e[3*o]=t.x,e[3*o+1]=t.y,e[3*o+2]=0,n[o]=t.opacity,r[o]=t.glowIntensity});const o=t.geometry;o.setAttribute("position",new u(e,3)),o.setAttribute("alpha",new u(n,1)),o.setAttribute("glow",new u(r,1)),o.attributes.position.needsUpdate=!0,o.attributes.alpha.needsUpdate=!0,o.attributes.glow.needsUpdate=!0,t.visible=!0}else t.visible=!1}else{const t=e.getObjectByName("flyingDots");t&&e.remove(t)}if(P.current&&k.current&&m[W].blurEnabled){R.current<1&&(R.current+=.05*s);const e=Math.min(1,R.current);(()=>{if(!k.current)return;const e=x.current,t=new Float32Array(3*e.length),n=new Float32Array(e.length),r=new Float32Array(e.length);e.forEach((e,o)=>{t[3*o]=e.x,t[3*o+1]=e.y,t[3*o+2]=0,n[o]=.5*e.opacity,r[o]=2.5*e.glowIntensity});const o=k.current.geometry;o.setAttribute("position",new u(t,3)),o.setAttribute("alpha",new u(n,1)),o.setAttribute("glow",new u(r,1)),o.attributes.position.needsUpdate=!0,o.attributes.alpha.needsUpdate=!0,o.attributes.glow.needsUpdate=!0})(),k.current.material.uniforms.uTime.value=.001*r;const t=k.current.geometry.attributes.alpha;for(let n=0;n<t.count;n++)t.setX(n,t.getX(n)*e*m[W].effectIntensity);t.needsUpdate=!0,k.current.visible=!0}else k.current&&(k.current.visible=!1);d.needsUpdate=!0,h.needsUpdate=!0,g.needsUpdate=!0,n.render(e,t),requestAnimationFrame(V)},Q=async()=>{if(T.current&&clearTimeout(T.current),"countdown"===b.current){if(M.current++,M.current>=f.length)return b.current="message",M.current=0,void(h.length>0?(await X(h[0],f[2]),T.current=setTimeout(Q,2800)):(N(1.2),null==y||y()));const e=f[M.current],t=f[M.current-1]||void 0;await X(e,t),T.current=e===f[2]?setTimeout(Q,1500):setTimeout(Q,1300)}else if("message"===b.current){if(M.current++,M.current>=h.length)return N(1.2),void setTimeout(()=>{null==y||y()},1200);const e=h[M.current];void 0!==e&&(await X(e,h[M.current-1]),T.current=setTimeout(Q,2800))}};return b.current="countdown",M.current=0,B(f[0]),T.current=setTimeout(Q,1300),requestAnimationFrame(V),()=>{var t,r,o,a;T.current&&clearTimeout(T.current),x.current=[],F.current=[],d&&d.removeChild(n.domElement),n.dispose(),k.current&&e.remove(k.current),v.current&&e.remove(v.current),e.traverse(e=>{if("geometry"in e&&e.geometry&&"function"==typeof e.geometry.dispose&&e.geometry.dispose(),"material"in e&&e.material){const t=e.material;Array.isArray(t)?t.forEach(e=>{e&&"function"==typeof e.dispose&&e.dispose()}):"function"==typeof t.dispose&&t.dispose()}}),U&&(U.uniforms.pointTexture.value&&(null==(r=(t=U.uniforms.pointTexture.value).dispose)||r.call(t)),U.dispose()),O&&(O.uniforms.pointTexture.value&&(null==(a=(o=O.uniforms.pointTexture.value).dispose)||a.call(o)),O.dispose())}},[h,L,D]),t.jsx("div",{ref:w,style:{width:"calc(100vw + env(safe-area-inset-left) + env(safe-area-inset-right))",height:"calc(100vh + env(safe-area-inset-top) + env(safe-area-inset-bottom))",maxWidth:"calc(100vw + env(safe-area-inset-left) + env(safe-area-inset-right))",maxHeight:"calc(100vh + env(safe-area-inset-top) + env(safe-area-inset-bottom))",background:"transparent",position:"absolute",top:0,left:0,overflow:"hidden",zIndex:9999,touchAction:"none"}})};const p=()=>t.jsxs("div",{className:"fixed inset-0 bg-black text-white flex flex-col items-center justify-center z-50",children:[t.jsx("img",{src:"/rotate.gif",alt:"Vui lòng xoay ngang màn hình",className:"w-32 h-32 mb-4"}),t.jsx("p",{className:"text-lg",children:"Vui lòng xoay ngang thiết bị của bạn"})]}),w=e=>{if("undefined"==typeof window)return 0;const t=document.createElement("div");t.style.position="fixed",t.style[e]="env(safe-area-inset-"+e+")",t.style.visibility="hidden",document.body.appendChild(t);const n=getComputedStyle(t),r=parseInt(n[e])||0;return document.body.removeChild(t),r},x=({text:n})=>{const r=e.useRef(null),o=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};return e.useEffect(()=>{o(),window.addEventListener("resize",o);const e=r.current,t=e.getContext("2d"),a=window.devicePixelRatio||1;return(()=>{const r=w("top"),o=w("bottom"),i=w("left"),s=w("right"),l=window.innerWidth+i+s,c=window.innerHeight+r+o;e.width=l*a,e.height=c*a,e.style.width=`${l}px`,e.style.height=`${c}px`,t.setTransform(1,0,0,1,0,0),t.scale(a,a);const d=12.8,u=Math.floor(l/7),h=Array.from({length:u},()=>Math.floor(c/d)),f=Array.from({length:u},(e,t)=>t%n.length),m=()=>{t.fillStyle="rgba(0, 0, 0, 0.06)",t.fillRect(0,0,l,c),t.fillStyle="#ffa3e0",t.font="16px 'Roboto', Arial, sans-serif";for(let e=0;e<u;e++){const o=n[f[e]%n.length],a=8;t.fillText(o,e*a+i,h[e]*d+r),h[e]++,f[e]=(f[e]+1)%n.length,h[e]*d>c&&Math.random()>.975&&(h[e]=0)}setTimeout(m,25)};m()})(),()=>{window.removeEventListener("resize",o)}},[n]),t.jsx("canvas",{ref:r,style:{position:"fixed",top:0,left:0,zIndex:-1,backgroundColor:"black",width:"calc(100vw + env(safe-area-inset-left) + env(safe-area-inset-right))",height:"calc(100vh + env(safe-area-inset-top) + env(safe-area-inset-bottom))",marginTop:"calc(-1 * env(safe-area-inset-top))",marginLeft:"calc(-1 * env(safe-area-inset-left))"}})};function v({countdown:n,countdownId:r}){const[o,a]=e.useState(!1),[i,s]=e.useState(!0),[l,c]=e.useState(null),d=e.useRef(null),u=function(){const[t,n]=e.useState(!0);return e.useEffect(()=>{const e=()=>{const e=window.innerWidth<=1024,t=window.innerWidth>window.innerHeight;n(!e||t)};return e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)}},[]),t}();return e.useEffect(()=>{r&&n&&c(n)},[]),e.useEffect(()=>{u||a(!1)},[u]),e.useEffect(()=>{const e=d.current;if(u&&e){const t=()=>{e.paused&&e.play().then(()=>{e.muted=!1}).catch(()=>{})};t();const n=()=>{t(),document.removeEventListener("click",n)};return document.addEventListener("click",n),window.addEventListener("wheel",t),window.addEventListener("mousedown",t),window.addEventListener("mousemove",t),window.addEventListener("touchstart",t),()=>{document.removeEventListener("click",n),window.removeEventListener("wheel",t),window.removeEventListener("mousedown",t),window.removeEventListener("mousemove",t),window.removeEventListener("touchstart",t)}}},[l,u]),e.useEffect(()=>{const e=e=>{const t=e.key.toLowerCase();if("F12"===e.key||e.ctrlKey&&e.shiftKey&&"i"===t||e.metaKey&&e.altKey&&"i"===t||e.ctrlKey&&"u"===t||e.metaKey&&"u"===t)return e.preventDefault(),e.stopPropagation(),!1},t=e=>(e.preventDefault(),!1);return document.addEventListener("keydown",e),document.addEventListener("contextmenu",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("contextmenu",t)}},[]),t.jsx(t.Fragment,{children:u?t.jsx(t.Fragment,{children:l&&r&&t.jsxs(t.Fragment,{children:[l.music&&t.jsx("audio",{ref:d,loop:!0,controls:!0,hidden:!0,children:t.jsx("source",{src:"/proxy-drive/"+l.music,type:"audio/mpeg"})}),t.jsx(x,{text:l.backgroundText}),t.jsx(y,{messages:l.messages,onComplete:()=>{s(!1),a(!0)}}),o&&t.jsx(h,{text:l.finalText})]})}):t.jsx(p,{})})}export{v as default};
